# Phase 3: Visuals & Art

## Goal
Replace all placeholder rectangles with "Soft Plastic Voxel" art generated by Google Gemini. Add player animations (idle, walk, jump), parallax backgrounds, proper tile textures, and polished UI styling. By the end, the game should *look* like a real kids' game.

**Depends on:** Phase 2 (GameScene and Player exist to integrate into)
**Can start in parallel:** Art generation (Gemini prompts) can begin during Phase 1

---

## Asset Pipeline

### Step 3.1 — Generate All Assets with Gemini

Use all 18 prompts from [art-prompts.md](art-prompts.md) to generate assets. For each asset:

1. Run the prompt in Google Gemini (Nano Banana Pro or equivalent image generation model)
2. Download the generated image
3. Open in any image editor (even free tools like Photopea, GIMP, or macOS Preview)
4. Crop/resize to the **exact pixel dimensions** specified
5. Save as PNG with transparency where noted
6. Place in the correct `public/assets/images/` subdirectory

### Step 3.2 — Asset Processing Checklist

| Asset | Dimensions | Transparency | Save To |
|-------|-----------|-------------|---------|
| grass-top.png | 64x64 | No | `tiles/` |
| dirt.png | 64x64 | No | `tiles/` |
| stone.png | 64x64 | No | `tiles/` |
| botty-idle.png | 256x64 (4 frames) | Yes | `player/` |
| botty-walk.png | 384x64 (6 frames) | Yes | `player/` |
| botty-jump.png | 128x64 (2 frames) | Yes | `player/` |
| sky.png | 800x600 | No | `backgrounds/` |
| clouds.png | 800x200 | Yes | `backgrounds/` |
| hills.png | 800x200 | Yes | `backgrounds/` |
| btn-play.png | ~200x70 | Yes | `ui/` |
| btn-levels.png | ~200x70 | Yes | `ui/` |
| star-filled.png | 32x32 | Yes | `ui/` |
| star-empty.png | 32x32 | Yes | `ui/` |
| math-input-bg.png | ~400x200 | Yes | `ui/` |
| arrow-left.png | 64x64 | Yes | `ui/` |
| arrow-right.png | 64x64 | Yes | `ui/` |
| arrow-jump.png | 64x64 | Yes | `ui/` |
| flag.png | 64x64 | Yes | `objects/` |
| bridge-block.png | 64x64 | No | `objects/` |
| dust.png | 8x8 | Yes | `particles/` |
| confetti.png | 8x8 | Yes | `particles/` |

**Sprite sheet requirements:**
- All frames must be **exactly** 64x64 pixels each
- Frames must be arranged in a **single horizontal strip** (no rows)
- Consistent spacing: frames must be packed edge-to-edge with no padding
- Transparent background between and around character pixels

**Tile requirements:**
- Tiles must be **seamless** on left and right edges (they tile horizontally)
- grass-top should have grass visible on the top edge and dirt on the bottom
- bridge-block should look distinct from ground tiles (wood vs. earth)

---

## Step 3.3 — Preload Scene

### src/game/scenes/PreloadScene.js

This scene loads every game asset and shows a progress bar while loading.

```js
import Phaser from 'phaser';

export default class PreloadScene extends Phaser.Scene {
  constructor() {
    super('Preload');
  }

  preload() {
    // ── Progress Bar ─────────────────────────────────
    const width = this.scale.width;
    const height = this.scale.height;

    // Background bar
    const barBg = this.add.rectangle(width / 2, height / 2, 320, 30, 0x2c3e50);
    barBg.setStrokeStyle(2, 0xffffff);

    // Fill bar
    const barFill = this.add.rectangle(
      width / 2 - 150, height / 2, 0, 22, 0x27ae60
    ).setOrigin(0, 0.5);

    // Loading text
    const loadingText = this.add.text(width / 2, height / 2 - 40, 'Loading...', {
      fontSize: '24px',
      fontFamily: 'Fredoka One',
      color: '#ffffff'
    }).setOrigin(0.5);

    // Update bar on progress
    this.load.on('progress', (value) => {
      barFill.width = 300 * value;
    });

    this.load.on('complete', () => {
      loadingText.setText('Ready!');
    });

    // ── Tiles ────────────────────────────────────────
    this.load.image('grass-top', 'assets/images/tiles/grass-top.png');
    this.load.image('dirt', 'assets/images/tiles/dirt.png');
    this.load.image('stone', 'assets/images/tiles/stone.png');

    // ── Player Sprite Sheets ─────────────────────────
    this.load.spritesheet('botty-idle', 'assets/images/player/botty-idle.png', {
      frameWidth: 64,
      frameHeight: 64
    });
    this.load.spritesheet('botty-walk', 'assets/images/player/botty-walk.png', {
      frameWidth: 64,
      frameHeight: 64
    });
    this.load.spritesheet('botty-jump', 'assets/images/player/botty-jump.png', {
      frameWidth: 64,
      frameHeight: 64
    });

    // ── Backgrounds ──────────────────────────────────
    this.load.image('sky', 'assets/images/backgrounds/sky.png');
    this.load.image('clouds', 'assets/images/backgrounds/clouds.png');
    this.load.image('hills', 'assets/images/backgrounds/hills.png');

    // ── UI Elements ──────────────────────────────────
    this.load.image('btn-play', 'assets/images/ui/btn-play.png');
    this.load.image('btn-levels', 'assets/images/ui/btn-levels.png');
    this.load.image('star-filled', 'assets/images/ui/star-filled.png');
    this.load.image('star-empty', 'assets/images/ui/star-empty.png');

    // ── Objects ──────────────────────────────────────
    this.load.image('flag', 'assets/images/objects/flag.png');
    this.load.image('bridge-block', 'assets/images/objects/bridge-block.png');

    // ── Particles ────────────────────────────────────
    this.load.image('dust', 'assets/images/particles/dust.png');
    this.load.image('confetti', 'assets/images/particles/confetti.png');

    // ── Audio (loaded here, used in Phase 6) ─────────
    this.load.audio('sfx-jump', 'assets/audio/jump.wav');
    this.load.audio('sfx-correct', 'assets/audio/correct.wav');
    this.load.audio('sfx-wrong', 'assets/audio/wrong.wav');
    this.load.audio('sfx-build', 'assets/audio/build.wav');
    this.load.audio('sfx-win', 'assets/audio/win.wav');
  }

  create() {
    // ── Define Player Animations ─────────────────────
    this.anims.create({
      key: 'botty-idle',
      frames: this.anims.generateFrameNumbers('botty-idle', { start: 0, end: 3 }),
      frameRate: 6,
      repeat: -1  // Loop forever
    });

    this.anims.create({
      key: 'botty-walk',
      frames: this.anims.generateFrameNumbers('botty-walk', { start: 0, end: 5 }),
      frameRate: 10,
      repeat: -1
    });

    this.anims.create({
      key: 'botty-jump',
      frames: this.anims.generateFrameNumbers('botty-jump', { start: 0, end: 1 }),
      frameRate: 4,
      repeat: 0  // Play once
    });

    // ── Transition to Menu ───────────────────────────
    this.scene.start('Menu');
  }
}
```

**Animation breakdown:**

| Animation | Frames | Frame Rate | Behavior |
|-----------|--------|------------|----------|
| `botty-idle` | 4 frames (gentle breathing bob) | 6 fps | Loops forever |
| `botty-walk` | 6 frames (walk cycle) | 10 fps | Loops forever |
| `botty-jump` | 2 frames (jump up + fall) | 4 fps | Plays once |

---

## Step 3.4 — Update Player with Animations

### Modifications to src/game/objects/Player.js

Replace the placeholder red square with the Botty spritesheet. Add animation state logic:

```js
// In constructor, replace the placeholder texture creation with:
const { x, y } = gridToPixel(gridX, gridY);
super(scene, x + TILE_SIZE / 2, y + TILE_SIZE / 2, 'botty-idle');

// In update(), add animation state management after movement logic:
update() {
  // ... existing movement code ...

  // ── Animation State ──────────────────────────────
  if (!this.body.blocked.down) {
    // In the air → play jump animation
    this.anims.play('botty-jump', true);
  } else if (Math.abs(this.body.velocity.x) > 10) {
    // On ground + moving → play walk animation
    this.anims.play('botty-walk', true);
  } else {
    // On ground + still → play idle animation
    this.anims.play('botty-idle', true);
  }
}
```

**Animation priority:**
1. Airborne → always show jump (highest priority)
2. Moving on ground → walk
3. Still on ground → idle (lowest priority)

The `true` parameter in `anims.play()` means "if this animation is already playing, don't restart it" — this prevents the animation from resetting every frame.

---

## Step 3.5 — Parallax Backgrounds

### Modifications to src/game/scenes/GameScene.js

Add background layers in `create()`, BEFORE creating platforms and player (so they render behind everything):

```js
// ── Parallax Background ────────────────────────────
// Sky: static, doesn't scroll at all
this.add.image(400, 300, 'sky')
  .setScrollFactor(0)
  .setDepth(-3);

// Clouds: slow parallax
this.cloudLayer = this.add.tileSprite(400, 100, 800, 200, 'clouds')
  .setScrollFactor(0)
  .setDepth(-2);

// Hills: medium parallax
this.hillLayer = this.add.tileSprite(400, 450, 800, 200, 'hills')
  .setScrollFactor(0)
  .setDepth(-1);
```

And in `update()`, scroll the parallax layers based on camera position:

```js
update() {
  // ... existing code ...

  // ── Parallax Scrolling ───────────────────────────
  if (this.cloudLayer) {
    this.cloudLayer.tilePositionX = this.cameras.main.scrollX * 0.1;
  }
  if (this.hillLayer) {
    this.hillLayer.tilePositionX = this.cameras.main.scrollX * 0.3;
  }
}
```

**Scroll factor explained:**
- Sky (`scrollFactor: 0`): Completely static — stays in place regardless of camera
- Clouds (`0.1`): Very slow parallax — distant, dreamy movement
- Hills (`0.3`): Medium parallax — feels like middle ground

Using `tileSprite` + `tilePositionX` instead of `scrollFactor` on regular sprites gives us seamless tiling for the horizontally repeating layers.

---

## Step 3.6 — Update Platforms with Tile Textures

### Modifications to src/game/scenes/GameScene.js

Replace the placeholder green rectangles with actual tile images:

```js
// In the platform building loop, replace 'tile-placeholder' with the level's tile type:
for (const p of levelData.platforms) {
  const { x: baseX, y: baseY } = gridToPixel(p.gridX, p.gridY);

  for (let i = 0; i < p.width; i++) {
    const tileKey = p.tile || 'grass-top'; // Fallback to grass

    const block = this.platforms.create(
      baseX + i * TILE_SIZE + TILE_SIZE / 2,
      baseY + TILE_SIZE / 2,
      tileKey  // Now uses the actual tile texture
    );
    block.setSize(TILE_SIZE, TILE_SIZE);
    block.refreshBody();
  }
}
```

### Bridge blocks

Update `src/game/objects/Bridge.js` to use the `bridge-block` texture:

```js
// Replace 'bridge-placeholder' with 'bridge-block'
const block = platformGroup.create(
  baseX + i * TILE_SIZE + TILE_SIZE / 2,
  baseY + TILE_SIZE / 2,
  'bridge-block'
);
```

### Goal flag

Replace the yellow rectangle goal with the flag sprite:

```js
this.goalFlag = this.add.sprite(
  goalPos.x + TILE_SIZE / 2,
  goalPos.y,  // Anchor at bottom of flag pole
  'flag'
).setOrigin(0.5, 1); // Bottom-center origin
this.physics.add.existing(this.goalFlag, true);
```

---

## Step 3.7 — Update BootScene

### Modifications to src/game/scenes/BootScene.js

BootScene should now transition to PreloadScene instead of directly to GameScene:

```js
create() {
  // Simple loading indicator while Fredoka One font loads
  this.add.text(
    this.scale.width / 2,
    this.scale.height / 2,
    'MathBuilder',
    {
      fontSize: '48px',
      fontFamily: 'Fredoka One',
      color: '#ffffff',
      stroke: '#2c3e50',
      strokeThickness: 6
    }
  ).setOrigin(0.5);

  // Brief delay to ensure web font is loaded, then proceed
  this.time.delayedCall(500, () => {
    this.scene.start('Preload');
  });
}
```

---

## Step 3.8 — Update GameConfig Scene Order

### src/game/GameConfig.js

```js
import BootScene from './scenes/BootScene.js';
import PreloadScene from './scenes/PreloadScene.js';
import GameScene from './scenes/GameScene.js';

// In config:
scene: [BootScene, PreloadScene, GameScene]
```

(MenuScene and LevelSelectScene are added in Phase 4)

---

## Step 3.9 — Polish the Math Input Overlay

The CSS from Phase 1 already provides a clean look. In this step, optionally enhance it:

- Use the `math-input-bg.png` as a background image for `#math-input-panel` instead of the plain CSS background
- Add a subtle entrance animation:

```css
#math-input-panel {
  /* ... existing styles ... */
  animation: popIn 0.3s ease-out;
}

@keyframes popIn {
  0% {
    transform: scale(0.8);
    opacity: 0;
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}
```

---

## Art Style Reference Guide

When reviewing Gemini outputs, look for these qualities:

**Keep (matches style):**
- Smooth, rounded edges (no pixel jaggies)
- Soft ambient lighting with gentle shadows
- Vibrant but not neon colors
- Chunky, toy-like proportions
- Clean silhouettes

**Reject and re-generate if:**
- Realistic/photorealistic rendering
- Sharp hard shadows
- Thin or spindly proportions
- Dull or muddy colors
- Complex detail that gets lost at 64x64

**Botty character consistency:**
- Always blue as the primary body color
- Square head, rectangular body, stubby legs
- Small antenna on top of head
- Two dot eyes (LED-like, friendly expression)
- No fingers — simple rounded arm stubs

---

## Files Created/Modified in This Phase

| File | Action | Purpose |
|------|--------|---------|
| `src/game/scenes/PreloadScene.js` | Create | Asset loading with progress bar + animation definitions |
| `src/game/scenes/BootScene.js` | Modify | Transition to PreloadScene |
| `src/game/objects/Player.js` | Modify | Use spritesheet, add animation state |
| `src/game/scenes/GameScene.js` | Modify | Parallax backgrounds, tile textures, flag sprite |
| `src/game/objects/Bridge.js` | Modify | Use bridge-block texture |
| `src/game/GameConfig.js` | Modify | Add PreloadScene to scene list |
| `style.css` | Modify | Add pop-in animation for math panel |
| All `public/assets/images/**` files | Create | Art assets from Gemini |

---

## Verification Checklist

- [ ] All assets load without 404 errors (check Network tab in browser dev tools)
- [ ] PreloadScene shows a progress bar that fills from left to right
- [ ] Botty renders with the correct spritesheet (not a red square)
- [ ] Idle animation plays when Botty is standing still (gentle breathing bob)
- [ ] Walk animation plays when moving left/right (legs moving, arm swing)
- [ ] Jump animation plays when in the air
- [ ] `flipX` flips Botty to face left when moving left
- [ ] Background has 3 visible layers: sky (static), clouds (slow), hills (medium)
- [ ] Parallax effect is visible when the camera scrolls horizontally
- [ ] Platform tiles render as grass blocks instead of green rectangles
- [ ] Bridge blocks render as wood planks instead of brown rectangles
- [ ] Goal flag renders as a flag sprite instead of a yellow rectangle
- [ ] Math input overlay has the pop-in animation and matches the kid-friendly style
- [ ] No visual glitches: no gaps between tiles, no z-order issues
- [ ] Game still plays correctly (all Phase 2 mechanics work with new art)
